\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{mathtools} 
\usepackage{stackengine}
\def\delequal{\mathrel{\ensurestackMath{\stackon[1pt]{=}{\scriptstyle\Delta}}}}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{amsmath,epsfig,cite,amsfonts,amssymb,psfrag,subfig}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\allowdisplaybreaks
\newtheorem{remark}{Remark}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\newtheorem{corollary}{Corollary}   

\begin{document}

\title{Joint Power Allocation and Network Slicing In an End to End O-RAN System
}

\author{\IEEEauthorblockN{1\textsuperscript{st} Mojdeh Karbalaee Motalleb}
\IEEEauthorblockA{\textit{Electrical and Computer Engineering} \\
\textit{Tehran University}\\
Tehran, Iran \\
mojdeh.karbalaee@ut.ac.ir}
\and
\IEEEauthorblockN{2\textsuperscript{nd} Given Name Surname}
\IEEEauthorblockA{\textit{dept. name of organization (of Aff.)} \\
\textit{name of organization (of Aff.)}\\
City, Country \\
email address}

}

\maketitle

\begin{abstract}

\end{abstract}

\begin{IEEEkeywords}
component, formatting, style, styling, insert
\end{IEEEkeywords}

\section{Introduction}
This document is a model and instructions for \LaTeX.
Please observe the conference page limits. 

\section{System Model and Problem Formulation}
In this section, first, we present the downlink (DL) of O-RAN System. Then we obtain achievable rate and delays.
Afterward, the main problem is expressed.
\subsection{System Model}
Suppose that there are $S$ slices Serving $V$ services. Each Service $v\in \{1,2,...,V \} $, consists of $U_v$ single antenna users that require certain service. Each slice $s \in \{1,2,...,S \}$ consists of $R_s$ RRHs and $N_s$ PRBs. All the RRHs in a slice that is mapped to a service, transmit signals to all the UEs in specific service. Each RRH $r \in \{1,2,...,R \}$ is connected to BBU pool via an optical fiber link with limited fronthaul capacity. Also each RRH and PRB can serve more than one slice. It is considered that in BBU, the system has two processing layer consists of $M_1$ homogeneous VMs in first layer and $M_2$ homogeneous VMs in second layer.
\subsection{Achievable Rate}
In this subsection, the Achievable Rate is obtained as below.
The achievable data rate for $i^{th}$ UE in $v^{th}$ service can be written as 
\begin{equation}\label{eq1}
\mathcal{R}_{u(v,i)} = B \log_2({1+ \rho_{u(v,i)}})
\end{equation}
where $B$ is the bandwidth of system and $\rho_{u(v,i)}$ is the SNR of $i^{th}$ UE in $v^{th}$ service which is obtained from 
\begin{equation}\label{eq2}
\rho_{u(v,i)} =  \frac{P_{u(v,i)}\sum_{s=1}^{N_s}|\bold{h}_{R_s,u(v,i)}^H \bold{w}_{R_s,u(v,i)}|^2 a_{vs}}{BN_0 + I_{u(v,i)}}
\end{equation}
Where, $P_{u(v,i)}$ represents the transmitted power allocated by RRHs to $i^{th}$ UE in $v^{th}$ service. Also, 
$\bold{h}_{R_s,u(v,i)} \in \mathbb{C}^{{R}_s}$ is the vector of channel gain of wireless link from RRHs in the $s^{th}$ slice to the $i^{th}$ UE in $v^{th}$ service. In addition, $\bold{w}_{R_s,u(v,i)} \in \mathbb{C}^{{R}_s}$ depicts the the transmit beamforming vector from RRHs in the $s^{th}$ slice to the $i^{th}$ UE in $v^{th}$ service. Moreover, $BN_0$ denotes the power of guassian additive noise and $I_{u(v,i)}$ is the power of interfering signals. 
To obtain SNR as formulated in equation \eqref{eq2}, let $\bold{y}_{U_v}\in \mathbb{C}^{U_v} $ be the received signal's vector of all users in $v^{th}$ service which is given by equation \eqref{eq3}
\begin{equation}\label{eq3}
\bold{y}_{U_v} = \sum_{k=1}^{N_k}\sum_{s = 1}^{N_s} \boldsymbol{H}^H_{\mathcal{R}_s,\mathcal{U}_v}(\boldsymbol{W}_{\mathcal{R}_s,\mathcal{U}_v}\boldsymbol{P}_{U_v}^{\frac{1}{2}}\boldsymbol{x}_{\mathcal{R}_s}+ \boldsymbol{q}_{R_s}) \zeta_{U_v,k,s}+ \boldsymbol{z}_{\mathcal{U}_v}
\end{equation}
where $\boldsymbol{x}_{ \mathcal{R}_s} = [x_{ r_{(s,1)}},...,x_{ r_{(s,\mathcal{R}_s)}}]^T \in \mathbb{C}^{{R}_s } $ depicts the transmitted symbol vector for the $s$-th set of Network slice,  $\boldsymbol{z}_{U_v}$ is the additive Gaussian noise $\boldsymbol{z_{U_v}} \backsim \mathcal{N}(0,N_0\boldsymbol{I}_{{U}_v})$ and $N_0$ is the noise power.
In addition, $\boldsymbol{q}_{R_s} \in \mathbb{C}^{{R}_s }  $ indicates the quantization noise which is made from signal compression in BBU.
\\
Furthermore, $\zeta_{U_v,k,s} \delequal \{\zeta_{u(v,1),k,s},\zeta_{u(v,2),k,s},...,\zeta_{u(v,N_{U_v}),k,s}\}$,
$\zeta_{u(v,i),k,s} \in \{0,1\}$ is a binary parameter that map Physical Resource Blocks(PRB) to UE.
Also as defined before, $\boldsymbol{H}_{\mathcal{R}_s,\mathcal{U}_v}=\left[\boldsymbol{h}_{\mathcal{R}_s,u_{(v,1)}},\ldots,\boldsymbol{h}_{\mathcal{R}_s,v_{(v,\mathcal{U}_v)}}\right]^T  \in \mathbb{C}^{{R}_s\times {U}_v }$ 
shows the channel matrix between RRH set $\mathcal{R}_s$ to UE set
$\mathcal{U}_v$. 
The channel vector from the RRH of  $s^{th}$ slice to the $i^{th}$ UE in the $v^{th}$ service $\boldsymbol{h}_{\mathcal{R}_s,u_{(v,i)}}\in \mathbb{C}^{{R}_s}$ is modeled as below
\begin{equation}
\boldsymbol{h}_{\mathcal{R}_s,u_{(s,i)}} = \boldsymbol{\beta}^\frac{1}{2}_{\mathcal{R}_s,u_{(v,i)}} \boldsymbol{g}_{\mathcal{R}_s,u_{(v,i)}},
\end{equation}
where $\boldsymbol{g}_{\mathcal{R}_s,u_{(v,i)}} \backsim \mathcal{N}(0,N_0\boldsymbol{I}_{\mathcal{U}_v})$ indicates the fast fading and flat fading channel vector and $\boldsymbol{\beta}_{\mathcal{R}_s,u_{(v,i)}}=\text{diag}(b_{r_{(s,1),u_{(v,i)}}},\ldots,b_{r_{(s,\mathcal{R}_s),u_{(v,i)}}})$
represents the large scale fading matrix. Here, it is assumed we have perfect channel state information(CSI).
\\
Moreover, $\boldsymbol{W}_{\mathcal{R}_s,\mathcal{U}_v} = [\boldsymbol{w}_{\mathcal{R}_s,u(v,1)},...,\boldsymbol{w}_{\mathcal{R}_s,u(v,U_v)}] \in \mathbb{C}^{{R}_s\times U_v} $ is the zero forcing beamforming vector to minimize the interference which is indicated as follow
\begin{equation}
\boldsymbol{W}_{\mathcal{R}_s,\mathcal{U}_v} = \boldsymbol{H}_{\mathcal{R}_s,\mathcal{U}_v}(\boldsymbol{H}_{\mathcal{R}_s,\mathcal{U}_v}^H \boldsymbol{H}_{\mathcal{R}_s,\mathcal{U}_v})^{-1}
\end{equation}
Hence, the interference power of $i^{th}$ UE in $v^{th}$ service can be represented as follow
\begin{equation}
\begin{split}
 I_{u_{(v,i)}} &= 
 \underbrace{\sum_{s=1}^{S}\sum_{n=1}^{N_s}\sum_{\substack{l=1 \\ l\neq i}}^{{U}_v} \gamma_{1}  p_{u_{(v,l)}}a_{vs}\zeta_{u_(v,i),n,s}\zeta_{u_(v,l),n,s}}_{\text{(intra-service interference)}}\\
&+ \underbrace{\sum_{\substack{y=1 \\ l\neq v}}^{V}\sum_{s=1}^{S}\sum_{n=1}^{N_s}\sum_{l=1}^{{U}_y} \gamma_{2}  p_{u_{(y,l)}}a_{ys} \zeta_{u_(v,i),n,s}\zeta_{u_(y,l),n,s}}_{\text{(inter-service interference)}}\\
&+\underbrace{ \sum_{s=1}^{S} \sum_{j=1}^{{R}_s} {\sigma_q}_{r_{(s,j)}}^2 |\boldsymbol{h}_{r_{(s,j)}, u_{(v,i)}}|^2 a_{vs}}_{\text{(quantization noise interference)}}.
\end{split}
\end{equation}
where, $\gamma_{1} =|\boldsymbol{h}_{\mathcal{R}_s, u_{(v,i)}}^H \boldsymbol{w}_{\mathcal{R}_{s},u_{(v,l)}}|^2$
and $\gamma_{2} =|\boldsymbol{h}_{\mathcal{R}_s, u_{(v,i)}}^H \boldsymbol{w}_{\mathcal{R}_{s},u_{(y,l)}}|^2$.
let $\bar{p}_{r_{(s,j)}}$ denote the power of transmitted signal from $j^{th}$ RRH in $s^{th}$ slice.
from equation \eqref{eq3} we have
\begin{equation}
\bar{p}_{r_{(s,j)}} = \sum_{v=1}^{V}\boldsymbol{w}_{r_{(s,j)},\mathcal{U}_{v}} \boldsymbol{P}_{\mathcal{U}_v}^{\frac{1}{2}} \boldsymbol{P}_{\mathcal{U}_v}^{H \frac{1}{2}}   \boldsymbol{w}_{r_{(s,j)},\mathcal{U}_{v}}^H a_{vs} + \sigma_{q_{r(s,j)}}^2.
\end{equation}
As a result the user data capacity on the fronthual link between BBU and the $j^{th}$ RRH in $s^{th}$ slice is formulated as below
\begin{equation}
C_{R_{(s,j)}} = \log{(1+\sum_{v=1}^{V}\frac{w_{r_{(s,j)},\mathcal{D}_{s}} \boldsymbol{P}_{\mathcal{U}_v}^{\frac{1}{2}} \boldsymbol{P}_{\mathcal{U}_v}^{H \frac{1}{2}}   w_{r_{(s,j)},\mathcal{U}_{v}}^H a_{vs}}{ \sigma_{q_{r(s,j)}}^2})},
\end{equation}
\subsection{Mean Delay}
Suppose that we have two processing layer in BBU of O-RAN system. The lower layer is consist of PHY and MAC and the upper layer is consist of RLC, PDCP and SDAP.\newline   
As it is mentioned before, we have $M_1$ VMs in the first layer and $M_2$ VMs in second layer. Each VM in both layers map to one or more slices. So in $s^{th}$ slice, there are $M_{s_1}$ VMs in first layer and $M_{s_2}$ VMs in second layer. Each VM in first and second layer has computational capacity that is  equal to $\mu_1$ and $\mu_2$ respectively. \\
Let the packet arrival of UEs have a Poisson Process with arrival rate $\lambda_{u(v,i)}$ for $i^{th}$ UE in $v^{th}$ service. 
Therefore, the mean arrival data rate of UEs in $s^{th}$ slice in the first layer is 
$\alpha_{s_1} = \sum_{v=1}^{V}\sum_{u=2}^{U_v}a_{vs}\lambda_{u(v,i)}$.  
Furthermore, the mean arrival rate of second layer is approximately equal to the mean arrival rate of first layer $\alpha_{s} =\alpha_{s_1} \approx \alpha_{s_2}$ since, by using Burkeâ€™s Theorem, the arrival packets of second layer which is processed in first layer is still Poisson with rate $\alpha_{s}$  
It is assumed that there are dispatchers in each layer for each slice to divide the incoming traffic to VMs.
Suppose the baseband processing of each VM is depicted as a M/M/1 processing queue.
Each packet is routed by one of VMs of slices. So the mean delay of slice $s$ which is related to incoming traffic rate routed to
each VM in first layer can be written as follow
\begin{equation}
d_{s_1} = \frac{1}{\mu_1 - \alpha_{s}/{M_{s_1}}}
\end{equation}
Also, the delay in $s^{th}$ slice in second layer can be formulated as below
\begin{equation}
d_{s_2} = \frac{1}{\mu_2 - \alpha_{s}/{M_{s_2}}}
\end{equation}
In addition, the arrival data rate to the queue of wireless transmission
 is equal to the arrival data rate of dispatcher.
Moreover, it is assumed that the service time of transmission queue for each slice $s$ has 
 an exponential distribution with mean $1/(R_{{tot}_s})$ and can be modeled as a M/M/1 queue. Therefore, 
the mean delay of transmission layer is 
\begin{equation}
d_{s_{tr}} = \frac{1}{R_{{tot}_s} - \alpha_{s}}
\end{equation}
Where, $R_{{tot}_s} =  \sum_{v=1}^{V}\sum_{u=2}^{U_v}a_{vs}R_{u(v,i)}$.
We define a new parameter which indicates mean delay of each slice
\begin{equation}
D_{s} = d_{s_1} + d_{s_2} + d_{s_{tr}} \forall s
\end{equation} 
\subsection{Physical Resource}
Assume each VM is mapped to one virtual network function (VNF) for simplicity. Each VNF requires
physical resources which contain RAM, Memory and CPU.
Let, the required resources for VNF $f$ in slice $s$ is represented by
\begin{equation}
\Omega_{(f,s)} = \{\Omega_{R_{f,s}}, \Omega_{M_{f,s}}, \Omega_{C_{f,s}} \}
\end{equation} 
Where, $\Omega_{R_{f,s}}, \Omega_{M_{f,s}}, \Omega_{C_{f,s}}$ indicate the amount of required RAM, Memory and CPU.
Also, in the Core Network(CN), there are $N_{D}$ data centers(DC), which served VNFs. Each DC contains several servers that supply VNF's needs.
The amount of RAM, Memory and CPU is denoted respectively by $\tau_{R_{j}}, \tau_{M_{j}}$ and $\tau_{C_{j}} $ for $j^{th}$ DC.
\begin{equation*}
\tau_j = \{\tau_{R_{j}}, \tau_{M_{j}}, \tau_{C_{j}} \}
\end{equation*}
\subsection{Problem Statement}
One of the most important parameters to estimate the optimality of the system is energy efficiency which is represented as sum-rate to sum-power as follow
\begin{equation}
\eta(\boldsymbol{P},\boldsymbol{A}) := \frac{\sum\limits_{v=1}^{V} \sum\limits_{k=1}^{{U}_v}\mathcal{R}_{u_{(v,k)}} }{\sum\limits_{s=1}^{S} \sum\limits_{i=1}^{{R}_s}\bar{p}_{r_{(s,i)}}} = \frac{R_{tot}(\boldsymbol{P},\boldsymbol{A})}{P_{r_{tot}}(\boldsymbol{P},\boldsymbol{A})},
\end{equation}
Assume the power consumption of baseband processing at each data center that is mapped to VMs of a slice is depicted as
$\phi$. So the total power can be represented as  
\begin{equation*}
\phi_{tot} = \sum_{s=1}^{S}\sum_{d=1}^{D_c}y_{s,d}\phi
\end{equation*} 
Where, $y_{s,d}$ is a binary variable which indicates whether $d^{th}$ data-center is mapped to VNFs of $s^{th}$ slice or not.\\
In this paper, the main goal is to simultaneously maximize sum-rate and minimize sum-power with the presence of constraints which is written as follow, 
\begin{subequations}
\begin{alignat}{4}
\max\limits_{\boldsymbol{P}, \boldsymbol{A}, \boldsymbol{y} }   \quad &   \eta(\boldsymbol{P},\boldsymbol{A})+\frac{1}{\phi_{tot}(\boldsymbol{Y})} \\
\text{subject to} \quad  & \bar{p}_{r_{(s,i)}} \leq P_{max} && \quad \forall s, \forall i, 
 \label{c11} \\
&p_{u_{(v,k)}}  \geq 0  &&\quad \forall v, \forall k,\label{c12} \\
&\mathcal{R}_{u_{(v,k)}} \geq  \mathcal{R}_{u_{(v,k)}}^{min} && \quad \forall v, \forall k,\label{c13} \\                                 
&C_{r_{(s,i)}} \leq C_{r_{(s,i)}}^{max}  &&\quad \forall s, \forall i, \label{c14}\\
&D_{s} \leq D_{s}^{th}  &&\quad \forall s,\label{c15} \\
& \sum_{s=1}^{S}a_{vs} \geq 1 &&\quad \forall s, \label{c21} \\
& \sum_{d=1}^{D_c}\sum_{v=1}^{V}y_{s,d}a_{vs} \geq 1\times\sum_{v=1}^{V}a_{vs} &&\quad \forall s,\label{c23} \\
& \sum_{f=1}^{F_s}\Omega_{\mathfrak{z}(f,s)} \leq  \sum_{d=1}^{D_c} y_{s,d} \tau_d                      
 && \quad \forall f, \forall s  \label{c22}
\end{alignat}
\label{constraints}
\end{subequations}
Where,$\boldsymbol{P} =[p_{u(v,k)}]  \forall v , \forall k $, $\boldsymbol{A} =[a_{vs}]  \forall v , \forall s $ and $\boldsymbol{Y} =[y_{s,d}]  \forall s , \forall d $. 
Equation \eqref{c11}, \eqref{c12} indicates respectively that the power of each RRH do not exceed the maximum power and power of each UE is a positive integer value. Also \eqref{c13} shows that the rate of each UE is more than a threshold. \eqref{c14} and \eqref{c15} depicts respectively that the capacity of fronthaul link is limited and the delay of receiving signal should be less than a threshold.  
Furthermore, \eqref{c21}
ensure that each service is mapped to one or more slice.
Also, \eqref{c23} guarantee that each slice (VNFs in two layers of slice) has been placed to one or more physical resources (DC). Moreover, in \eqref{c22}  $\mathfrak{z}\in \{M,R,C\}$, which supports 
that we have enough physical resource for VNFs of each slice.\newline 
The main optimizaiton problem which is formulated as \eqref{constraints} can be decomposed into two independent optimization problem. The First and main problem is
\begin{subequations}
\begin{alignat}{4}
\max\limits_{\boldsymbol{P}, \boldsymbol{A} }   \quad &   \eta(\boldsymbol{P},\boldsymbol{A})\\
\text{subject to} \quad  & \bar{p}_{r_{(s,i)}} \leq P_{max} && \quad \forall s, \forall i,   \\
&p_{u_{(v,k)}}  \geq 0  &&\quad \forall v, \forall k, \\
&\mathcal{R}_{u_{(v,k)}} \geq  \mathcal{R}_{u_{(v,k)}}^{min} && \quad \forall v, \forall k, \\                                 
&C_{r_{(s,i)}} \leq C_{r_{(s,i)}}^{max}  &&\quad \forall s, \forall i, \\
&D_{s} \leq D_{s}^{th}  &&\quad \forall s
\end{alignat}
\label{constraints1}
\end{subequations}
and the second problem is 
\begin{subequations}
\begin{alignat}{4}
\min\limits_{\boldsymbol{y} }   \quad &   \phi_{tot}(\boldsymbol{Y})\\
\text{subject to} \quad  & \bar{p}_{r_{(s,i)}} \leq P_{max} && \quad \forall s, \forall i,   \\
& \sum_{s=1}^{S}a_{vs} \geq 1 &&\quad \forall s, \\
& \sum_{d=1}^{D_c}\sum_{v=1}^{V}y_{s,d}a_{vs} \geq 1\times\sum_{v=1}^{V}a_{vs} &&\quad \forall s, \\
& \sum_{f=1}^{F_s}\Omega_{(f,s)} \leq  \sum_{d=1}^{D_c} y_{s,d} \tau_d                       && \quad \forall f, \forall s 
\end{alignat}
\label{constraints2}
\end{subequations}
\subsection{Proposed Method For Problem \eqref{constraints1}}
In this subsection, the proposed method is applied to solve the optimization problem.
We want to solve \eqref{constraints1}. Since the problem is non-convex, iterative algorithm is applied.
To solve the problem and obtain optimum $\boldsymbol{A}$ and $\boldsymbol{P}$ we divide problem \eqref{constraints1} to 
two different part that can be solved iteratively.  
\subsubsection{First Sub-Problem}
Firstly, we need to obtain $\boldsymbol{A}$ by fixing $\boldsymbol{P} = \boldsymbol{P}_{max}$ in the problem \eqref{constraints1} and updating this parameter at the end of each iteration. Two different method is applied to acquire $\boldsymbol{A}$. The first method is using MOSEK and second method is a heuristic algorithm.
The details of heuristic algorithm are represented in \textbf{Algorithm} \eqref{alg}.  
\begin{algorithm}
\caption{Mapping Slice to Service}\label{alg}
\begin{algorithmic}[1]
\State Sort services according to their priority, the number of UEs in it and their requirements in descending order.
\State Sort slices according to the number of PRBs, RRHs and VNFs in two layers and the Capacity of their resources in descending order. 
\For {$ 1\leq i \leq  S$}
\For {$ 1\leq j \leq  V$}
\State Set $a_{ij} = 1$
\State Obtain Parameters of System
\If {conditions \eqref{c11}, \eqref{c12}, \eqref{c13} and \eqref{c14} is not applied} 
\State Set $a_{ij} = 0$;
\Else
\State break from inner loop;
\EndIf 
\State \textbf{end if}
\EndFor 
\State \textbf{end for}
\EndFor 
\State \textbf{end for}
\end{algorithmic}
\end{algorithm}
\subsubsection{Second Sub-Problem}
In this part, by assuming that $\boldsymbol{A}$ is fixed, the optimal power of UEs in each service is achieved.
\begin{theorem}\label{t2}
 $\eta^*$ which is the optimum energy efficiency can be achieved if
\begin{equation}\label{q2}
\begin{split}
&\max \limits_{\boldsymbol{P}} (R_{tot}(\boldsymbol{P}) - \eta^* P_{r_{tot}}(\boldsymbol{P}))=\\
& R_{total}(\boldsymbol{P}^*) - \eta^* P_{r_{tot}}(\boldsymbol{P}^*) =0.
\end{split}
\end{equation}
\end{theorem}
Using Lagrangian function and iterative algorithm, can solve this subproblem. 
%\section*{References}


\end{document}
